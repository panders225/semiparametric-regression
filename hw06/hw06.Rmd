---
title: "Assignment_06 - STAT 689"
author: "Philip Anderson; panders2@tamu.edu"
date: "2/14/2018"
output: pdf_document
---

```{r, message=F}
# import third-party modules
library("HRW")
library("tidyverse")
library("mgcv")
```

Read in our data
```{r}
fram <- read.csv("/Users/panders2/Documents/schools/tamu/stat_689/homework/semiparametric-regression/hw06/framington.csv")
names(fram) <- tolower(names(fram))
dim(fram)

```

Create new variables for the systolic blood pressure readings and the two cholesterol measurements.

```{r}
# systolic blood pressure first
fram$lsbp <- log(((fram$sbp21 + fram$sbp22 + fram$sbp31 + fram$sbp32) / 4) - 50)
# cholesterol measurements second
fram$lcholest <- log((fram$cholest2 + fram$cholest3) / 2)
``` 

Keep only the variables that we will be working with directly and make sure everything seems reasonable.

```{r}
fram2 <- fram %>%
  dplyr::select(chd, age, smoker, lsbp, lcholest)
head(fram2)
```

# Question 1
Fit a multiple linear regression of LSBP on lcholest and smoker via "lm" function.  Produce a estimates, standard errors, and p-values.

```{r}
# fit model
lin_mod <- lm(lsbp ~ smoker + lcholest
              , data=fram2
              )
# produce summary
summary(lin_mod)
```


# Question 2
Conduct web research on whether smokers have higher or lower blood pressure on average compared to non-smokers.

WebMD indicates that individuals who smoke tend to have higher blood pressure than those who do not.  This is not consistent with my findings from Question 1, which indicate that participants who smoke have lower blood pressure than those who do not, conditional on our transformed cholesterol variable.  There is nothing in the documentation to indicate that smoker is not encoded with '1' as the positive class.  This is suspicious, and suggests that we need to check our data or revisit our model specification. 

# Question 3
The model produces the expectation of LSBP given smoking status _conditional on_ cholesterol.

# Question 4
Recreate the same model as in Question 1, but add in an interaction amongst the independent variables.

```{r}
lin_mod2 <- lm(lsbp ~ smoker + lcholest + smoker:lcholest
              , data=fram2
              )

summary(lin_mod2)
```

The smoking indicator is still negatively associated with our blood pressure variable, but is no longer significant in the presence of the interaction term.

# Question 5
Run a semiparametric ANCOVA with mgcv, the semiparametric version of an ANCOVA without an interaction.

```{r}
semi_mod <- mgcv::gam(lsbp ~ factor(smoker) +
                        s(lcholest, k=23, bs="cr")
                      , data=fram2
                      , method="REML"
                     )
summary(semi_mod)
```

# Question 6
For the data in part 5, display a plot of the two lines, but without the data

```{r} 
# first, generate the data required for plotting

x_var <- seq(from=min(fram2$lcholest)
             , to=max(fram2$lcholest)
             , len=1000
             )
f_hat_smoker <- predict(semi_mod
                        , newdata=data.frame(
                         smoker=rep('0', 1000)
                         , lcholest=x_var
                        )
                        )


f_hat_nosmoke <- predict(semi_mod
                         , newdata=data.frame(
                            smoker=rep('1', 1000)
                            , lcholest=x_var
                           ) 
                         )
```


```{r}
plot(fram2$lcholest, fram2$lsbp, type="n"
     , xlab="Cholesterol Variable"
     , ylab = "Blood Pressure Variable"
     , main="Blood Presure by Cholesterol ANCOVA comparison"
       )

lines(x_var, f_hat_smoker, lty=2, lwd=2.5)
lines(x_var, f_hat_nosmoke, lty=3, lwd=2.5)

legend(4.8, 5
       , c("Smoker", "NonSmoker")
       , lty=c(2,3))
```


```{r}

```



# Question 7
Skipping for now

# Question 8
Run the semiparametric version of ANCOVA but with an interaction.  

```{r}
semi_mod2 <- mgcv::gam(lsbp ~ factor(smoker)*lcholest +
                        s(lcholest, k=23, bs="cr")
                      , data=fram2
                      , method="REML"
                     )
summary(semi_mod2)

```




